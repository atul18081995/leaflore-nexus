<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ plant.common_name }} | LeafLore Nexus</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="description" content="{{ plant.common_name }} ({{ plant.scientific_name }}) ‚Äî botanical details, care, uses, and climate-specific guidance.">
    <link rel="canonical" href="{{ request.build_absolute_uri }}">

    <style>
        :root {
            --accent: #2c7a7b;
            --soft-bg: #f8fcfb;
            --border-light: #e6f2ef;
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont;
            margin: 0;
            padding: 1rem;
            line-height: 1.6;
            color: #222;
            background: linear-gradient(
                180deg,
                #f6fbfa 0%,
                #f9faf9 45%,
                #ffffff 100%
            );
        }

        a { color: var(--accent); text-decoration: none; }
        a:hover { text-decoration: underline; }

        .page-container {
            max-width: 960px;
            margin: 1.5rem auto;
            background: #ffffff;
            padding: 1.75rem;
            border-radius: 16px;
            box-shadow: 0 12px 30px rgba(0,0,0,0.05);
            position: relative;
        }

        .page-container::before {
            content: "";
            display: block;
            height: 6px;
            width: 100%;
            border-radius: 6px;
            background: linear-gradient(90deg, #2c7a7b, #68d391);
            margin-bottom: 1rem;
        }

        h1 { margin-bottom: 0.25rem; }
        .meta { color: #555; font-size: 0.9rem; margin-bottom: 1rem; }

        .section-heading {
            margin-top: 2rem;
            padding-bottom: 0.3rem;
            border-bottom: 1px solid #ddd;
            color: var(--accent);
            font-weight: 600;
        }

        .sub-heading {
            margin-top: 1.4rem;
            color: var(--accent);
            font-weight: 600;
        }

        .content-section {
            margin-top: 1.5rem;
            padding: 1.25rem;
            background: var(--soft-bg);
            border-radius: 12px;
            border: 1px solid var(--border-light);
        }

        .primary-image {
            width: 100%;
            height: 340px;
            border-radius: 14px;
            overflow: hidden;
            background: #eaeaea;
            margin: 1rem 0;
            cursor: pointer;
        }

        .primary-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .gallery {
            display: flex;
            gap: 0.6rem;
            overflow-x: auto;
            margin-bottom: 1.5rem;
        }

        .gallery-image {
            width: 96px;
            height: 96px;
            border-radius: 8px;
            overflow: hidden;
            background: #f0f0f0;
            border: 1px solid #ddd;
            cursor: pointer;
        }

        .gallery-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .care-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .care-item {
            background: #ffffff;
            padding: 0.9rem;
            border-radius: 10px;
            border: 1px solid #eaeaea;
            box-shadow: 0 4px 12px rgba(0,0,0,0.04);
        }

        .care-item strong {
            display: block;
            font-size: 0.9rem;
            font-weight: 700;
            color: #000;
            margin-bottom: 0.35rem;
            letter-spacing: 0.02em;
        }

        /* ===== CLIMATE MATRIX ===== */

        .climate-matrix {
            margin-top: 2rem;
        }

        .climate-title {
            font-size: 1.15rem;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 0.9rem;
            padding: 0.6rem 0.9rem;
            background: linear-gradient(
                90deg,
                rgba(44, 122, 123, 0.12),
                rgba(44, 122, 123, 0.04)
            );
            border-left: 4px solid var(--accent);
            border-radius: 8px;
            letter-spacing: 0.02em;
        }

        .season-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }

        .season-cell {
            background: linear-gradient(135deg, #eef8f6, #ffffff);
            border-radius: 14px;
            border: 1px solid var(--border-light);
            box-shadow: 0 6px 18px rgba(0,0,0,0.05);
            padding: 0.9rem 1rem 1.1rem;
        }

        .season-name {
            font-weight: 700;
            color: var(--accent);
            text-align: center;
            margin-bottom: 0.6rem;
            text-transform: uppercase;
            letter-spacing: 0.04em;
        }

        .season-content p {
            margin: 0.5rem 0;
            font-size: 0.95rem;
        }

        .content-section ul {
            margin: 0.75rem 0 0;
            padding-left: 1.2rem;
        }

        .content-section li {
            margin-bottom: 0.4rem;
        }

        /* ‚úÖ UPDATED: Season note now matches Watering/Sunlight typography */
        .season-note {
            margin: 0.5rem 0;
            font-size: 0.95rem;
            color: #333;
        }

        @media (max-width: 700px) {
            .season-grid {
                grid-template-columns: 1fr;
            }
        }

        .nursery-cta {
            color: #ffffff;
            background: linear-gradient(90deg, #2c7a7b, #68d391);
            border: none;
            border-radius: 999px;
            cursor: not-allowed;
            opacity: 0.85;
        }

        .nursery-cta .cta-icon {
            font-size: 1.05rem;
            filter: drop-shadow(0 1px 1px rgb(0, 0, 0));
        }

        .notify-form {
            margin-top: 0.75rem;
            display: flex;
            gap: 0.5rem;
        }

        .notify-form input {
            flex: 1;
            padding: 0.45rem 0.6rem;
            border-radius: 6px;
            border: 1px solid #ccc;
            font-size: 0.9rem;
        }

        .notify-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.45rem;

            padding: 0.55rem 1.1rem;
            height: 38px;
            border-radius: 999px;

            background: var(--accent);
            color: #ffffff;
            font-weight: 600;
            font-size: 0.9rem;

            border: none;
            cursor: pointer;
            white-space: nowrap;
        }


        .notify-btn:hover {
            opacity: 0.9;
        }

        .messages {
            margin: 1rem 0 1.5rem;
        }

        .message {
            padding: 0.7rem 1rem;
            border-radius: 8px;
            font-size: 0.95rem;
            margin-bottom: 0.5rem;
        }

        .message.success {
            background: #e6fffa;
            border-left: 4px solid #2c7a7b;
            color: #065f5b;
        }

        .message.error {
            background: #fdecea;
            border-left: 4px solid #b00020;
            color: #7a1020;
        }

        /* Highlight animation */
        .message {
            animation: slideFadeIn 0.4s ease-out;
        }

        /* Auto fade-out class */
        .message.fade-out {
            opacity: 0;
            transform: translateY(-6px);
            transition: opacity 0.6s ease, transform 0.6s ease;
        }

        @keyframes slideFadeIn {
            from {
                opacity: 0;
                transform: translateY(-6px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .nursery-actions {
            margin-top: 1.25rem;
            display: flex;
            flex-direction: column;
            gap: 0.9rem;
        }

        /* Cart + Wishlist row */
        .nursery-action-row {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        /* Keep wishlist visually secondary */
        .wishlist-form {
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .nursery-cta,
        .wishlist-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.45rem;

            height: 40px;                 /* üî¥ hard lock */
            padding: 0 1.25rem;           /* horizontal only */
            border-radius: 999px;

            font-size: 0.95rem;
            font-weight: 600;
            line-height: 1;               /* üî¥ critical */
            white-space: nowrap;
        }

        .wishlist-btn {
            background: #fde2e4;
            color: #9f1239;
            border: none;
            cursor: pointer;
        }

        .wishlist-btn:hover {
            background: #fecdd3;
        }

        /* Mobile polish */
        @media (max-width: 600px) {
            .nursery-action-row {
                flex-direction: column;
                align-items: stretch;
            }

            .wishlist-btn {
                width: 100%;
                text-align: center;
            }
        }

        .nursery-primary-actions {
            display: flex;
            align-items: center;
            gap: 0.75rem;   /* spacing between buttons */
            flex-wrap: wrap;
        }

        .placeholder {
            color: #777;
            font-style: italic;
            background: #f3f3f3;
            padding: 0.75rem;
            border-left: 4px solid #ccc;
            border-radius: 6px;
        }
    </style>
</head>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const messages = document.querySelectorAll(".message");

        messages.forEach(message => {
            setTimeout(() => {
                message.classList.add("fade-out");

                setTimeout(() => {
                    message.remove();
                }, 600); // remove after fade animation
            }, 5000); // 5 seconds visible
        });
    });
</script>

<body>

<a href="/plants/">‚Üê Back to plants</a>

<div class="page-container">
    {% if messages %}
    <div class="messages">
        {% for message in messages %}
            <div class="message {{ message.tags }}">
                {{ message }}
            </div>
        {% endfor %}
    </div>
{% endif %}

<h1>{{ plant.common_name }}</h1>
<div class="meta"><em>{{ plant.scientific_name }}</em></div>

{% for img in plant.images.all %}
{% if img.is_primary %}
<div class="primary-image">
    <img src="{{ img.image.url }}" alt="{{ plant.common_name }}">
</div>
{% endif %}
{% endfor %}

<div class="content-section">
    <h2 class="section-heading">Overview</h2>
    <p>{{ plant.description }}</p>
</div>

<div class="content-section">
    <h2 class="section-heading">Care & Cultivation</h2>

    {% if plant.care %}
    <div class="care-grid">
        <div class="care-item"><strong>‚òÄÔ∏è Light</strong>{{ plant.care.light_requirement }}</div>
        <div class="care-item"><strong>üíß Watering</strong>{{ plant.care.watering_frequency }}</div>
        <div class="care-item"><strong>üå± Soil</strong>{{ plant.care.soil_type }}</div>
        <div class="care-item"><strong>üå°Ô∏è Temperature</strong>{{ plant.care.temperature_range }}</div>
        <div class="care-item">
            <strong>üè° Placement</strong>
            {{ plant.care.get_indoor_outdoor_display }} ¬∑ {{ plant.care.get_pot_or_ground_display }}
        </div>
    </div>

    {% if plant.has_nursery %}
    <div class="content-section">
        <h2 class="section-heading">Nursery Information</h2>

        {% if plant.nursery.is_sellable %}
            <p><strong>Status:</strong> üå± Available in nursery</p>
        {% else %}
            <p><strong>Status:</strong> ‚è≥ Not currently available</p>
        {% endif %}

        <ul>
            <li>
                <strong>Propagation:</strong>
                {{ plant.nursery.propagation_method }}
            </li>

            {% if plant.nursery.grow_time_days %}
            <li>
                <strong>Grow Time:</strong>
                {{ plant.nursery.grow_time_days }} days
            </li>
            {% endif %}

            <li>
                <strong>Difficulty:</strong>
                {{ plant.nursery.difficulty|title }}
            </li>
        </ul>

        {% if plant.nursery.nursery_notes %}
            <p>{{ plant.nursery.nursery_notes }}</p>
        {% endif %}

        <p style="margin-top: 1rem; font-size: 0.9rem; color: #555;">
            This plant is available through our nursery network.
            Ordering and delivery options will be enabled soon.
        </p>

    <div class="nursery-actions">
        <div class="nursery-action-row">
            <button class="nursery-cta" disabled>
                <span class="cta-icon">üõí</span>
                <span class="cta-text">Coming Soon</span>
            </button>
            <form method="post"
                action="{% url 'wishlist-add' plant.id %}"
                class="wishlist-form">
                {% csrf_token %}

                {% if not user.is_authenticated %}
                    <input
                        type="email"
                        name="email"
                        placeholder="Email for wishlist"
                        required
                    >
                {% endif %}

                <button type="submit" class="wishlist-btn">
                    ‚ù§Ô∏è Add to Wishlist
                </button>
            </form>
</div>
    <form method="post"
          action="{% url 'nursery-notify' plant.id %}"
          class="notify-form">
        {% csrf_token %}
        <input
            type="email"
            name="email"
            placeholder="Enter email for notification"
            required
        >
        <button type="submit" class="notify-btn">
            üîî Notify when available
        </button>
    </form>
    </div>
    </div>
    {% endif %}

    {% if plant.care.beginner_mistakes %}
        <h3 class="sub-heading">Common Beginner Mistakes</h3>
        <p>{{ plant.care.beginner_mistakes }}</p>
    {% endif %}
    {% endif %}
</div>

<div class="content-section">
    <h2 class="section-heading">Climate & Seasonal Adjustments</h2>

    {% if plant.care and plant.care.climate_overrides.all %}
    {% regroup plant.care.climate_overrides.all by climate_zone as climate_groups %}

    {% for group in climate_groups %}
        <div class="climate-matrix">
            <div class="climate-title">{{ group.grouper|title }} Climate</div>

            <div class="season-grid">

                <!-- SUMMER -->
                <div class="season-cell">
                    <div class="season-name">Summer</div>
                    {% for rule in group.list %}
                        {% if rule.season == "summer" %}
                            <div class="season-content">
                                <p><strong>üíß Watering</strong><br>{{ rule.watering_adjustment }}</p>
                                {% if rule.sunlight_adjustment %}
                                <p><strong>‚òÄÔ∏è Sunlight</strong><br>{{ rule.sunlight_adjustment }}</p>
                                {% endif %}
                                {% if rule.special_notes %}
                                <p class="season-note">
                                    <strong>üìù Season Note</strong><br>
                                    {{ rule.special_notes }}
                                </p>
                                {% endif %}
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>

                <!-- MONSOON -->
                <div class="season-cell">
                    <div class="season-name">Monsoon</div>
                    {% for rule in group.list %}
                        {% if rule.season == "monsoon" %}
                            <div class="season-content">
                                <p><strong>üíß Watering</strong><br>{{ rule.watering_adjustment }}</p>
                                {% if rule.sunlight_adjustment %}
                                <p><strong>‚òÄÔ∏è Sunlight</strong><br>{{ rule.sunlight_adjustment }}</p>
                                {% endif %}
                                {% if rule.special_notes %}
                                <p class="season-note">
                                    <strong>üìù Season Note</strong><br>
                                    {{ rule.special_notes }}
                                </p>
                                {% endif %}
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>

                <!-- WINTER -->
                <div class="season-cell">
                    <div class="season-name">Winter</div>
                    {% for rule in group.list %}
                        {% if rule.season == "winter" %}
                            <div class="season-content">
                                <p><strong>üíß Watering</strong><br>{{ rule.watering_adjustment }}</p>
                                {% if rule.sunlight_adjustment %}
                                <p><strong>‚òÄÔ∏è Sunlight</strong><br>{{ rule.sunlight_adjustment }}</p>
                                {% endif %}
                                {% if rule.special_notes %}
                                <p class="season-note">
                                    <strong>üìù Season Note</strong><br>
                                    {{ rule.special_notes }}
                                </p>
                                {% endif %}
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>

            </div>
        </div>
    {% endfor %}
    {% else %}
        <p class="placeholder">Climate-specific guidance will be added soon.</p>
    {% endif %}
</div>

{% if plant.toxicity or plant.precautions %}
<div class="content-section">
    <h2 class="section-heading">Safety & Precautions</h2>
    {% if plant.toxicity %}<p><strong>Toxicity:</strong> {{ plant.toxicity }}</p>{% endif %}
    {% if plant.precautions %}<p><strong>Precautions:</strong> {{ plant.precautions }}</p>{% endif %}
</div>
{% endif %}

</div>

</body>
</html>